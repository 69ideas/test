{"version":3,"sources":["BA.js","BA.Actions.js","BA.Bindings.js","BA.Events.js","BA.Options.js","init.js"],"names":[],"mappings":"AAAA;AACA;AACA;ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvEA;AACA;AACA;ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"admin.js","sourcesContent":["var BA = {\n\n};","BA.Actions = {\n\n    init: function (context) {\n        $('.carusel-remove-row', context).click(BA.Events.CaruselDeleteRow).change();\n        $('.carusel-add-row', context).click(BA.Events.CaruselAddRow).change();\n\n        $('input[name=\"resource_type\"]').change(BA.Events.ResourceTypeChanged);\n\n        $('input[name=\"resource_type\"]:checked').change();\n        $('.related-type', context).change(BA.Events.RelatedType);\n        $('.related-type', context).change();\n\n        console.log($('.related-category', context));\n        $('.related-category', context).change(BA.Events.RelatedCategory);\n        $('.related-product', context).change(BA.Events.RelatedProduct);\n        $('.related-location', context).change(BA.Events.RelatedLocation);\n\n        $(\".add-participant\", context).click(BA.Events.TabContentManage);\n        $(\".edit-participant\", context).click(BA.Events.TabContentManage);\n\n        console.log($('.datepicker',context));\n        $('.datepicker',context).datepicker({\n            autoclose: true,\n            format: 'mm/dd/yyyy',\n            zIndex:100000\n        });\n\n        $(\"form\").submit(function(){\n            $(this).find('[type=\"submit\"]').prop('disabled', true);\n        });\n        tinymce.init(BA.Options.wysiwyg);\n\n        log('GCA inited on');\n        log(context);\n    },\n    \n    OpenModal: function (title, content) {\n\n        console.log('try to open modal');\n\n        var template = '<div class=\"modal\" tabindex=\"-1\" role=\"dialog\">' +\n            '<div class=\"modal-dialog\">' +\n            '<div class=\"modal-content\">' +\n            '<div class=\"modal-header\">' +\n            '<button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button>' +\n            '<h4 class=\"modal-title\"></h4>' +\n            '</div>' +\n            '<div class=\"modal-body\">' +\n            '</div>' +\n            '</div>' +\n            '</div>' +\n            '</div>';\n\n\n        if (BA.Bindings.CurrentWindow != null)\n            BA.Bindings.CurrentWindow.find('.close').click();\n\n        var wnd = $(template);\n\n        wnd.find('.modal-title').html(title);\n        wnd.find('.modal-body').append(content);\n\n        $(\"body\").append(wnd);\n\n\n\n        wnd.modal('show');\n        wnd.on('hidden.bs.modal', BA.Events.ModalClosed);\n        wnd.on('hide.bs.modal', BA.Events.ModalClosing);\n        BA.Bindings.CurrentWindow = wnd;\n    }\n};","BA.Bindings = {\n    CurrentWindow : null\n};","BA.Events = {\n\n    AddBlockContentClick: function (e) {\n        $.get($(this).prop('href') + '/' + $('.media').length, null, BA.Events.NewBlockContentResponse, 'json');\n\n        e.preventDefault();\n    },\n\n    CityChanged: function () {\n        if ($(this).val() == '')\n            $('.new_city').slideDown();\n        else\n            $('.new_city').slideUp();\n\n    },\n    RelatedType: function(e)\n    {\n        $('#data_holder_type').slideUp();\n        //$(this).val() - �������� �� �������\n        $.get('/admin/type?related=' + $(this).val(), null, function(data){\n\n            var content = $(data.content);\n            BA.Actions.init(content);\n            $('#data_holder_type').slideDown().html('').append(content);\n            console.log(data.data);\n            console.log(data);\n        }, 'json');\n    },\n    TabContentManage: function(e)\n    {\n        e.preventDefault();\n        var href = $(this).prop('href');\n        $.get(href, null, BA.Events.TabContentManageLoaded, 'json');\n    },\n\n    TabContentManageLoaded:function(data)\n    {\n        if(data.error_code != 0)\n        {\n            alert('Error happened');\n            return ;\n        }\n\n        var content = $(data.content);\n        BA.Actions.init(content);\n\n        var title = data.title || \"\";\n\n        BA.Actions.OpenModal(title, content);\n    },\n    MoveUpBlockClick: function (e) {\n        var block = $(this).parents('.media');\n        var line_block = block.prev();\n        var next_block = line_block.prev();\n\n        if (next_block.hasClass('media')) {\n            next_block.prev().after(block);\n            block.after(line_block);\n        }\n\n        BA.Actions.RebuildUIBlocks();\n        e.preventDefault();\n\n    },\n\n    MoveDownBlockClick: function (e) {\n        var block = $(this).parents('.media');\n        var line_block = block.next();\n        var next_block = line_block.next();\n\n        if (next_block.hasClass('media')) {\n            next_block.next().after(block);\n            block.after(line_block);\n        }\n\n        BA.Actions.RebuildUIBlocks();\n        e.preventDefault();\n    },\n\n    DeleteBlockClick: function (e) {\n        $(this).parents('.media').slideUp('slow', function () {\n            $(this).prev().remove();\n            $(this).remove();\n\n            BA.Actions.RebuildUIBlocks();\n\n        });\n\n        e.preventDefault();\n    },\n\n    DeletePhotoClick: function (e) {\n        $.get($(this).prop('href'), null);\n        $(this).parent().find('img').remove();\n        $(this).remove();\n\n        e.preventDefault();\n    },\n\n    UploadPhotoClick: function (e) {\n        $(this).parent().find('input').click();\n        e.preventDefault();\n    },\n\n    NewBlockContentResponse: function (data) {\n        if (data.status == 'ok') {\n            var content = $(data.content);\n            BA.Actions.init(content);\n\n            var last_item = $('.media').last();\n\n            if (last_item.length > 0) {\n                last_item.after(content);\n                last_item.after('<hr />');\n            }\n            else {\n                last_item = $('hr.limiter')\n                last_item.before('<hr />');\n                last_item.after(content);\n            }\n\n            BA.Actions.RebuildUIBlocks();\n        }\n    },\n\n    ResourceTypeChanged: function () {\n        var type = $(this).val();\n        var image_field_holder = $('.media_upload_image');\n        var youtube_link_holder = $('.media_youtube_link');\n\n        if (type == 'image') {\n            image_field_holder.show();\n            youtube_link_holder.hide()\n        }\n        else {\n            image_field_holder.hide();\n            youtube_link_holder.show();\n        }\n    },\n\n    CaruselDeleteRow: function (e)\n    {\n        e.preventDefault();\n\n        $(this).parents('tr').remove();\n    },\n\n    CaruselAddRow: function (e)\n    {\n        console.log($(this).prop('href'));\n        $.get($(this).prop('href') + '/' + ($('table.carusel-rows tr').length - 1), null, BA.Events.NewCaruselRowResponse, 'json');\n        e.preventDefault();\n\n    }, ModalClosed: function(e) {\n        $(this).remove();\n        e.preventDefault();\n    },\n\n    ModalClosing: function(e) {\n        BA.Bindings.CurrentWindow = null;\n    },\n\n    SubmitAjaxForm: function(e)\n    {\n        e.preventDefault();\n\n        var _form = $(this);\n        _form.find('.error_desc').remove();\n        _form.find('.form-group').removeClass('has-error');\n\n        $.ajax({\n            type: \"POST\",\n            url: $(this).prop('action'),\n            data: $(this).serialize(),\n            success: function(data, status){BA.Events.AjaxFormHandler(data, status, _form)},\n            error: function(response, status){BA.Events.AjaxFormHandlerFailed(response, status, _form)},\n            dataType: 'json'\n        });\n    },\n\n    AjaxFormHandler: function(data, status, _form)\n    {\n        if(data.error_code == 0)\n        {\n            data = data.data;\n            $.get(data.url, null, ERP.Events.TabContentLoaded, 'json');\n        }\n    },\n\n    TabContentLoaded: function(data, type)\n    {\n        if(data.error_code == 0)\n        {\n            data = data.data;\n            var tab = $('#tab_' + data.type);\n            tab.html('');\n            var content = $(data.content);\n            BA.Actions.init(content);\n            tab.append(content);\n\n            if(BA.Bindings.CurrentWindow != null)\n                BA.Bindings.CurrentWindow.find('.close').click();\n        }\n\n    },\n\n    AjaxFormHandlerFailed: function(response, status, _form)\n    {\n        if(response.status == 422)\n        {\n            for(var i in response.responseJSON)\n            {\n                var block = _form.find(\"[name='\" + i + \"']\").parents('.form-group');\n\n                block.addClass('has-error');\n                block.append('<p class=\"help-block error_desc\">' + response.responseJSON[i].join('<br/>') + '</p>')\n            }\n        }\n        console.log(response);\n    },\n\n    SubmitMainForm: function(e)\n    {\n        e.preventDefault();\n\n        $('.main_form_'+$(this).data('form')).submit();\n    },\n\n    NewCaruselRowResponse: function(data)\n    {\n        if(data.status == 'ok')\n        {\n            var content = $(data.content);\n            BA.Actions.init(content);\n\n            $('table.carusel-rows').append(content);\n\n\n        }\n    }\n};","BA.Options = {\n    wysiwyg: {\n        selector: 'textarea.wysiwyg',\n        plugins: [\n            \"advlist autolink link image lists charmap print preview hr anchor pagebreak\",\n            \"searchreplace wordcount visualblocks visualchars insertdatetime media nonbreaking\",\n            \"table contextmenu directionality emoticons paste textcolor responsivefilemanager code\"\n        ],\n        toolbar2: \"| responsivefilemanager | link unlink anchor | image media | forecolor backcolor  | print preview code \",\n        menubar: false,\n        image_advtab: true ,\n        relative_urls: false,\n\n        external_filemanager_path:\"/filemanager/\",\n        filemanager_title:\"Filemanager\" ,\n        external_plugins: { \"filemanager\" : \"/filemanager/plugin.min.js\"}\n    }\n};","var DEBUG = true;\nfunction log(msg) {\n    if (DEBUG)\n        console.log(msg);\n}\n\n$(function () {\n    BA.Actions.init($('body'))\n});\ntinymce.init(BA.Options.wysiwyg);\n"],"sourceRoot":"/source/"}